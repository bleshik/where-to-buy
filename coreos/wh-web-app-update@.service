[Unit]
Description=Updating Unit
Requires=docker.service
Requires=fleet.service
After=docker.service
After=fleet.service

[Service]
Type=simple
TimeoutStartSec=0
ExecStart=/bin/sh -c 'if [ "`docker inspect --format {{.Id}} bleshik/wh-web-app`" != "`(docker pull bleshik/wh-web-app > /dev/null; docker inspect --format {{.Id}} bleshik/wh-web-app)`" ] ; then echo "New version of bleshik/wh-web-app downloaded. I will restart it now..."; /usr/bin/fleetctl stop wh-web-app@%i.service; /usr/bin/fleetctl start wh-web-app@%i.service ; fi'

[X-Fleet]
MachineOf=wh-web-app@%i.service
